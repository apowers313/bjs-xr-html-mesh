<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Babylon Template</title>

    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>

    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
    <!-- <script src="https://lil-gui.georgealways.com/dist/lil-gui.esm.min.js"></script> -->
</head>

<body>
    <canvas id="renderCanvas" touch-action="none"></canvas>

    <script type="module">
        import { HtmlMesh } from "../index";
        import GUI from 'https://cdn.jsdelivr.net/npm/lil-gui@0.19/+esm';
        const parameters = {
            radius: 0.6,
            tube: 0.2,
            tubularSegments: 150,
            radialSegments: 20,
            p: 2,
            q: 3,
            thickness: 0.5
        };

        function onChange() {
            // console.log("GUI changed.")
        }

        const gui = new GUI({ width: 300 });
        gui.add(parameters, 'radius', 0.0, 1.0).onChange(onChange);
        gui.add(parameters, 'tube', 0.0, 1.0).onChange(onChange);
        gui.add(parameters, 'tubularSegments', 10, 150, 1).onChange(onChange);
        gui.add(parameters, 'radialSegments', 2, 20, 1).onChange(onChange);
        gui.add(parameters, 'p', 1, 10, 1).onChange(onChange);
        gui.add(parameters, 'q', 0, 10, 1).onChange(onChange);
        gui.add(parameters, 'thickness', 0, 1).onChange(onChange);
        gui.domElement.style.visibility = 'hidden';

        const canvas = document.getElementById("renderCanvas"); // Get the canvas element
        const engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine

        var createScene = function () {
            var scene = new BABYLON.Scene(engine);

            var camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI / 2, Math.PI / 3, 25, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(1, 1, 0), scene);
            light.intensity = 0.7;

            new HtmlMesh(gui.domElement, scene);

            return scene;
        };

        const scene = createScene(); //Call the createScene function
        scene.ambientColor = new BABYLON.Color3(1, 1, 1);

        // XR
        // const xrHelper = scene.createDefaultXRExperienceAsync().then(() => {
        //     // Register a render loop to repeatedly render the scene
        //     engine.runRenderLoop(function () {
        //         scene.render();
        //     });
        // })

        engine.runRenderLoop(function () {
            scene.render();
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>